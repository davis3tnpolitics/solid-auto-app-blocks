# Contributing

## Automation Changes

Generator behavior is contract-tested. Any generator, manifest, or workflow change should include matching tests in `automations/tests`.

Run locally:

```bash
pnpm test:automations
pnpm lint:automation-contracts
```

Recommended local runtime baseline: Node.js `>=20.9.0` (matches Next.js 16 requirements for app lint/build scripts).

When manifest/workflow contracts change, update:

- `README.md` (command/interface docs)
- `CONTRIBUTING.md` (rules/policies)
- `CHANGELOG.md` or a `.changeset/*.md` entry

## Snapshot Policy

Use snapshots only for high-signal generator contract files.

Update snapshots intentionally:

```bash
pnpm test:automations:update
```

If snapshot output changes, include a short note in the PR explaining whether the change is expected and contract-safe.

## Contract-Breaking Changes

Treat these as contract-breaking and document them clearly:

- changed generated file paths
- removed generated routes/DTOs/modules
- changed manifest names/entries/options semantics
- changed default generator flags that alter output shape

## CI Workflows

The repo uses two CI layers:

- repo infrastructure workflow: `.github/workflows/automations-tests.yml`
- app workflows: `.github/workflows/app-<name>-ci.yml` generated by `next-app`, `nest-app`, or `github-workflow-app`

If you add a new app generator, ensure CI workflow generation is part of that generator contract (or clearly document why it is intentionally skipped).

If you change `next-crud-pages` contracts, update and verify:

- generated model hook names/query-key conventions
- generated route map (`/<plural>`, `/<plural>/[id]`, `/<plural>/create`, `/<plural>/[id]/edit`)
- generated list behavior mode (`--list-mode table|infinite`) wiring to hooks
- generated override contract (`src/lib/<plural-model>/overrides.ts`) for hidden/readonly/widget/validator behavior
- shared CRUD UI primitive usage (`CrudList`, `CrudTable`, `CrudDetail`, `CrudForm`)
- snapshot coverage in `automations/tests/test/contracts`

If you change `cube-service-updator` contracts, update and verify:

- generated analytics paths (`src/analytics/cubes`, `src/analytics/contracts`, `src/analytics/index.ts`)
- generated scoped-filter defaults (`--tenant-field`) and security contract output
- generated `cube-helpers` usage patterns in cube artifacts
- snapshot coverage in `automations/tests/test/contracts`

If you change `cube-app` contracts, update and verify:

- CLI-first bootstrap behavior (`cubejs-cli`) and deterministic fallback behavior
- generated app scripts/dependency shape used by app CI workflows
- generated baseline files (`cube.js`, `model/*`, env/readme scaffolding)
- snapshot coverage in `automations/tests/test/contracts`

## UI Adapter and Chart Rules

`packages/ui` now has coverage-gated adapter/chart/form tests.

Run locally:

```bash
pnpm test:ui
```

Required when changing UI data contracts:

- new adapter in `packages/ui/lib/cubejs-adapters.ts` must include unit tests for happy path and edge cases
- chart prop/data-shape changes must update chart tests in `packages/ui/components/charts/charts.test.tsx`
- form behavior changes must update interaction/validation tests in `packages/ui/components/forms/fields.test.tsx`
